#ifndef SRC_CPP_FASTMATH_HPP_
#define SRC_CPP_FASTMATH_HPP_

#include <cmath>
#include <iterator>

// clang-format off
static constexpr double kLog2Precomp[] = {
 0.0, 0.0, 1.0, 1.584962500721156, 2.0, 2.321928094887362, 2.584962500721156, 2.807354922057604, 3.0, 3.169925001442312, 3.321928094887362, 3.4594316186372973, 3.584962500721156, 3.700439718141092, 3.807354922057604, 3.9068905956085187, 4.0, 4.087462841250339, 4.169925001442312, 4.247927513443585, 4.321928094887363, 4.392317422778761, 4.459431618637297, 4.523561956057013, 4.584962500721156, 4.643856189774724, 4.700439718141092, 4.754887502163468, 4.807354922057604, 4.857980995127572, 4.906890595608519, 4.954196310386875, 5.0, 5.044394119358453, 5.087462841250339, 5.129283016944966, 5.169925001442312, 5.20945336562895, 5.247927513443585, 5.285402218862249, 5.321928094887363, 5.357552004618084, 5.392317422778761, 5.426264754702098, 5.459431618637297, 5.491853096329675, 5.523561956057013, 5.554588851677638, 5.584962500721156, 5.614709844115208, 5.643856189774724, 5.672425341971495, 5.700439718141092, 5.727920454563199, 5.754887502163468, 5.78135971352466, 5.807354922057604, 5.832890014164741, 5.857980995127572, 5.882643049361842, 5.906890595608519, 5.930737337562887, 5.954196310386875, 5.977279923499917, 6.0, 6.022367813028454, 6.044394119358453, 6.066089190457772, 6.087462841250339, 6.108524456778169, 6.129283016944966, 6.149747119504682, 6.169925001442312, 6.189824558880018, 6.20945336562895, 6.22881869049588, 6.247927513443585, 6.266786540694901, 6.285402218862249, 6.303780748177103, 6.321928094887363, 6.339850002884624, 6.357552004618084, 6.3750394313469245, 6.392317422778761, 6.409390936137702, 6.426264754702098, 6.442943495848728, 6.459431618637297, 6.475733430966398, 6.491853096329675, 6.507794640198696, 6.523561956057013, 6.539158811108031, 6.554588851677638, 6.569855608330948, 6.584962500721156, 6.599912842187128, 6.614709844115208, 6.6293566200796095, 6.643856189774724, 6.658211482751795, 6.672425341971495, 6.6865005271832185, 6.700439718141092, 6.714245517666122, 6.727920454563199, 6.741466986401147, 6.754887502163468, 6.768184324776926, 6.78135971352466, 6.794415866350106, 6.807354922057604, 6.820178962415188, 6.832890014164741, 6.845490050944375, 6.857980995127572, 6.870364719583405, 6.882643049361842, 6.894817763307944, 6.906890595608519, 6.918863237274595, 6.930737337562887, 6.94251450533924, 6.954196310386875, 6.965784284662087, 6.977279923499917, 6.9886846867721655, 7.0, 7.011227255423254, 7.022367813028454, 7.03342300153745, 7.044394119358453, 7.05528243550119, 7.066089190457772, 7.076815597050831, 7.087462841250339, 7.098032082960526, 7.108524456778169, 7.118941072723508, 7.129283016944966, 7.139551352398794, 7.149747119504682, 7.159871336778389, 7.169925001442312, 7.1799090900149345, 7.189824558880018, 7.199672344836364, 7.20945336562895, 7.219168520462161, 7.22881869049588, 7.2384047393250786, 7.247927513443585, 7.257387842692652, 7.266786540694901, 7.2761244052742375, 7.285402218862249, 7.294620748891627, 7.303780748177103, 7.312882955284356, 7.321928094887363, 7.330916878114617, 7.339850002884624, 7.348728154231077, 7.357552004618084, 7.366322214245816, 7.3750394313469245, 7.383704292474052, 7.392317422778761, 7.400879436282184, 7.409390936137702, 7.417852514885898, 7.426264754702098, 7.434628227636725, 7.442943495848728, 7.451211111832329, 7.459431618637297, 7.467605550082998, 7.475733430966398, 7.483815777264256, 7.491853096329675, 7.499845887083206, 7.507794640198696, 7.515699838284043, 7.523561956057013, 7.531381460516312, 7.539158811108031, 7.546894459887636, 7.554588851677638, 7.562242424221073, 7.569855608330948, 7.577428828035749, 7.584962500721156, 7.592457037268081, 7.599912842187128, 7.60733031374961, 7.614709844115208, 7.622051819456376, 7.6293566200796095, 7.636624620543649
};
// clang-format on

struct FastMath {
    double log2(short x) const
    {
        if (x >= 1 && x < static_cast<short>(std::size(kLog2Precomp))) {
            return kLog2Precomp[x];
        } else {
            return std::log2(x);
        }
    }
};

#endif  // SRC_CPP_FASTMATH_HPP_
